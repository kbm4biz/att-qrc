<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mobile QR Validator</title>
    <!-- Keep the same CSS styles as before -->
</head>
<body>
    <!-- Keep the same HTML structure as before -->

    <script>
        // CONFIGURATION (Must match teacher's settings)
        const SECRET_PHRASE = 'SCHOOL_SECRET_2024'; // ðŸ”‘ Must match teacher's secret
        const REFRESH_INTERVAL = 10000; // 10 seconds (must match teacher's interval)

        // QR Validation Logic (Aligned with Teacher's Algorithm)
        function validateQRData(data) {
            try {
                // 1. Decode base64 payload
                const decoded = atob(data);
                const payload = JSON.parse(decoded);
                
                // 2. Get current time window (10-second intervals)
                const currentWindow = Math.floor(Date.now() / 10000);
                const previousWindow = currentWindow - 1;
                
                // 3. Validate timestamp (allow current & previous window)
                if (![currentWindow, previousWindow].includes(payload.t)) {
                    return false;
                }
                
                // 4. Regenerate hash using teacher's algorithm
                const expectedHash = simpleHash(
                    payload.t.toString() + 
                    payload.s + 
                    SECRET_PHRASE
                );
                
                // 5. Compare hashes
                return payload.h === expectedHash;
                
            } catch (error) {
                console.error('Validation error:', error);
                return false;
            }
        }

        // Must match teacher's simpleHash function exactly
        function simpleHash(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                hash = (hash << 5) - hash + str.charCodeAt(i);
                hash |= 0; // Convert to 32bit integer
            }
            return hash.toString(36).slice(-8);
        }

        // Modified scanFrame function
        function scanFrame() {
            if (!scannerActive) return;
            
            const video = document.getElementById('video-preview');
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0);
            
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const code = jsQR(imageData.data, imageData.width, imageData.height);
            
            if (code) {
                const isValid = validateQRData(code.data);
                document.getElementById('status').className = isValid ? 'valid' : 'invalid';
                document.getElementById('status').innerHTML = isValid ?
                    'âœ… Valid QR Code' : 
                    'âŒ Invalid QR Code';
                
                // Continue scanning after validation
                setTimeout(scanFrame, 1000);
            } else {
                requestAnimationFrame(scanFrame);
            }
        }

        // Rest of the code remains the same -->
    </script>
</body>
</html>
